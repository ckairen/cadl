trigger:
  - main
pr:
  - main

jobs:
  - job: Build_And_Test
    strategy:
      matrix:
        "Linux - Node 16.x":
          imageName: MMSUbuntu20.04
          pool: azsdk-pool-mms-ubuntu-2004-general
          nodeVersion: "16.14.2"

        "Windows - Node 16.x":
          imageName: MMS2019
          pool: azsdk-pool-mms-win-2019-general
          nodeVersion: "16.14.2"

        "Linux - Node 18.x":
          imageName: MMSUbuntu20.04
          pool: azsdk-pool-mms-ubuntu-2004-general
          nodeVersion: "18.2.0"

        "Windows - Node 18.x":
          imageName: MMS2019
          poo: azsdk-pool-mms-win-2019-general
          nodeVersion: "18.2.0"

    pool:
      name: $(pool)
      vmImage: $(imageName)

    steps:
      - script: echo '##vso[task.setvariable variable=CADL_VS_CI_BUILD;]true'
        displayName: Enable official Visual Studio extension build
        condition: eq(variables.imageName, 'windows-latest')

      - template: pull-request-common.yml
        parameters:
          nodeVersion: $(nodeVersion)
          imageName: $(imageName)

  - job: docker_build
    pool:
      name: azsdk-pool-mms-ubuntu-2004-general
      vmImage: MMSUbuntu20.04
    steps:
      - script: docker build -f ./docker/Dockerfile .
        displayName: Docker build

  - job: Consistency_Check
    pool:
      name: azsdk-pool-mms-ubuntu-2004-general
      vmImage: MMSUbuntu20.04

    steps:
      - template: pull-request-consistency.yml
